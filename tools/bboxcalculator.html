---
title: Bbox Calculator
layout: default
---
<link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.css" />
<script src="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.js"></script>
<script src='//api.tiles.mapbox.com/mapbox.js/plugins/leaflet-draw/v0.2.2/leaflet.draw.js'></script>
<link href='//api.tiles.mapbox.com/mapbox.js/plugins/leaflet-draw/v0.2.2/leaflet.draw.css' rel='stylesheet' />

<style>.row{font-family:monospace;}
.row{height:450px;}
#map{position:absolute;width:90%;height:400px;float:left;}
</style>
	<div class="row">
		<div class="col-lg-4">
			<h1>BBOX CALCULATOR</h1>
			<p>Activate the tool (third button on map), then click and drag to draw a bounding box</p>

			SIZE (max 1280x720) <input type="text" id="aspect" style="width:330px"/>
			<br/>
			BBOX <input type="text" id="bbox" style="width:330px"/>
			<br/>
			BBOX INVERTED <input type="text" id="bboxinv" style="width:330px"/>
			<br/>
			JS BBOX <input type="text" id="jsbbox" style="width:330px"/>
			<br/>
			JS BBOX INVERTED <input type="text" id="jsbboxinv" style="width:330px"/>
			<br/>
		</div>
		<div class="col-lg-8">
			<div id="map" style=""></div>
			</div>
	</div>

<script>
function calcbbox(bbox){
	var bbarr=bbox.split(",");

	var max_width=1280;
	var max_height=720;
	//a 44°
	var lat_metri=111112.21066641241;
	var lon_metri=80206.16339921234;

	var dw=(bbarr[2]-bbarr[0])*lon_metri;
	var dh=(bbarr[3]-bbarr[1])*lat_metri;

	//calcolo aspect ratio
	var aspect=dw/dh;
	var stdaspect=max_width/max_height;

	if(aspect>stdaspect){
	document.getElementById("aspect").value=max_width+" "+(max_width/dw*dh).toFixed(0);
	}
	else{
	document.getElementById("aspect").value=(max_height/dh*dw).toFixed(0)+" "+max_height;
	}
}

var map = L.map('map').setView([44, 9], 7);

L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {
    attribution: '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'
}).addTo(map);

var drawnItems = new L.FeatureGroup();
		map.addLayer(drawnItems);

		var drawControl = new L.Control.Draw({
			draw: {
				position: 'topleft',
				polygon: false,
				polyline: false,
				circle: false,
				marker: false
			},
			edit: {
        featureGroup: drawnItems
    }
		});
		map.addControl(drawControl);

 function createdraw(e) {
        handledraw(e.layer);
}

function editdraw(e) {
    var layers = e.layers;
    layers.eachLayer(function (layer) {
        handledraw(layer);
    });
}

		function handledraw(layer) {
			var pointarr=layer.getLatLngs();

			var minlat=-90;
			var maxlat=90;
			var minlon=-180;
			var maxlon=180;

			for(var i in pointarr)
			{
			var p=pointarr[i];
			if(p.lat>minlat)minlat=p.lat;
			if(p.lat<maxlat)maxlat=p.lat;
			if(p.lng>minlon)minlon=p.lng;
			if(p.lng<maxlon)maxlon=p.lng;
			}

			var bbstring=minlon.toFixed(6)+","+minlat.toFixed(6)+","+maxlon.toFixed(6)+","+maxlat.toFixed(6);
			document.getElementById("bbox").value=bbstring;
			var bbinvstring=minlat.toFixed(6)+","+minlon.toFixed(6)+","+maxlat.toFixed(6)+","+maxlon.toFixed(6);
			document.getElementById("bboxinv").value=bbinvstring;
			var jsbbstring="[["+minlon.toFixed(6)+","+minlat.toFixed(6)+"],["+maxlon.toFixed(6)+","+maxlat.toFixed(6)+"]]";
			document.getElementById("jsbbox").value=jsbbstring;
			var jsbbinvstring="[["+minlat.toFixed(6)+","+minlon.toFixed(6)+"],["+maxlat.toFixed(6)+","+maxlon.toFixed(6)+"]]";
			document.getElementById("jsbboxinv").value=jsbbinvstring;

			drawnItems.addLayer(layer);

			/* calcolo bbox */
			var bbarr=bbstring.split(",");

			var max_width=1280;
			var max_height=720;
			//a 44°
			var lat_metri=111112.21066641241;
			var lon_metri=80206.16339921234;

			var dw=(bbarr[2]-bbarr[0])*lon_metri;
			var dh=(bbarr[3]-bbarr[1])*lat_metri;

			//calcolo aspect ratio
			var aspect=dw/dh;
			var stdaspect=max_width/max_height;

			if(aspect>stdaspect){
			document.getElementById("aspect").value=max_width+"x"+(max_width/dw*dh).toFixed(0);
			}
			else{
			document.getElementById("aspect").value=(max_height/dh*dw).toFixed(0)+"x"+max_height;
			}
			/* fine calcolo */
		}

		map.on('draw:created', createdraw);

		map.on('draw:edited', editdraw);

</script>
